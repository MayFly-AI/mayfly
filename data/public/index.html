<!doctype html>
<html lang="en" class="h-100">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="">
		<meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
		<meta name="generator" content="Hugo 0.84.0">
		<title>MayFly AI Mesh status</title>

		<!-- Bootstrap core CSS -->

		<link href="../components/bootstrap-5.2.2-dist/css/bootstrap.min.css" rel="stylesheet">

		<!-- Favicons -->
		<link rel="icon" type="image/x-icon" href="mayfly.ico">
		<meta name="theme-color" content="#7952b3">

		<link rel="stylesheet" href="../../components/font-awesome/css/font-awesome.min.css">

		<style>
			.bd-placeholder-img {
				font-size: 1.125rem;
				text-anchor: middle;
				-webkit-user-select: none;
				-moz-user-select: none;
				user-select: none;
			}
			@media (min-width: 768px) {
				.bd-placeholder-img-lg {
					font-size: 3.5rem;
				}
			}
		</style>
		<link href="picam.css" rel="stylesheet">
	</head>
	<body class="d-flex flex-column h-100">
		<nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark" aria-label="Main navigation">
			<div class="container">
				<a class="navbar-brand">
					<img src="logo-mayfly-horz.svg" height="36px"></img>
				</a>
				<button class="navbar-toggler p-0 border-0" type="button" id="navbarSideCollapse" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="navbar-collapse offcanvas-collapse" id="navbarsExampleDefault">
					<ul class="navbar-nav me-auto mb-2 mb-lg-0">
						<li class="nav-item" onclick="ShowView('dashboard');">
							<a class="nav-link active" id="svin" name="db">Dashboard</a>
						</li>
						<li class="nav-item"onclick="ShowView('services');">
							<a class="nav-link" name="pr" >Services</a>
						</li>
					</ul>
				</div>
			</div>
		</nav>
		<main class="container">

	<!--
			<div id='showdashboarddiv' style="display:none">
				<h2>Dashboard</h2>
				<div class="table-responsive">
					<table class="table table-striped table-sm">
						<tbody>
							<p id="tabledashboard"></p>
						</tbody>
					</table>
				</div>
				<div id='charts'></div>
			</div>

			<div id='showstatusdiv' style="display:none">
				<div class="table-responsive">
					<table class="table table-striped table-sm">
						<tbody>
							<p id="serverstatus"></p>
						</tbody>
					</table>
				</div>
				<div id='charts'></div>
			</div>

			<div id='showpropsdiv' style="display:none">
				<h2>Properties</h2>
				<div class="table-responsive">
					<table class="table table-striped table-sm">
						<tbody>
							<p id="tableremotes"></p>
						</tbody>
					</table>
				</div>
			</div>
	-->

			<div class="container my-3">
				<div class="p-1 my-3 rounded shadow-sm" style="background-color:gainsboro;">
					<nav aria-label="breadcrumb" id="breadcrumbList">
						<ol class="breadcrumb m-2" >
							<li class="breadcrumb-item"><a href="#">Home</a></li>
							<li class="breadcrumb-item"><a href="#">Library</a></li>
	<!--						<li class="breadcrumb-item active" aria-current="page">Data</li>-->
						</ol>
					</nav>
				</div>
				<div id='showdashboarddiv' style="display:none">
					<div class="row gy-3">
						<div class="col-12">
							<div class="card rounded-1 shadow">
								<h5 class="card-header">Dashboard</h5>
								<div class="card-body p-0">
									<p id="tabledashboard"></p>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div id='editservicesdiv' style="display:none">
					<div class="row gy-3">
						<div class="col-12" id='propertiesdiv' style="display:none">
							<div class="card rounded-1 shadow">
								<h5 class="card-header" id='propertiestitle'>Properties</h5>
								<div class="card-body p-0">
									<p id="propertiestable"></p>
									<div class="btn-group btn-group-sm m-2 float-end" role="group" aria-label="First group">
										<button type="button" class="btn btn-primary" id="updateproperties">Update</button>
										<button type="button" class="btn btn-primary" id="backproperties">Back</button>
									</div>
								</div>
							</div>
						</div>
						<div class="col-12" id='servicesdiv' style="display:none">
							<div class="card rounded-1 shadow">
								<h5 class="card-header" id='servicestitle'>Services</h5>
								<div class="card-body p-0">
									<p id="editservicestable"></p>
								</div>
							</div>
						</div>
						<div class="col-12" id='statusdiv' style="display:none">
							<div class="card rounded-1 shadow">
								<h5 class="card-header" id='statustitle'>Status</h5>
								<div class="card-body p-0">
									<p id="statustable"></p>
									<button type="button" class="btn btn-primary m-1 pull-right btn-sm" id="backstatus">Back</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

				<!--
							<div class="col-12">
								<div class="card bg-info shadow">
									<h5 class="card-header">Featured</h5>
									<div class="card-body">
									<h5 class="card-title">Special title treatment</h5>
									<p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
									<a href="#" class="btn btn-primary">Go somewhere</a>
									</div>
								</div>
							</div>
							<div class="col-12">
								<div class="card shadow">
									<h5 class="card-header">Featured</h5>
									<div class="card-body">
									<h5 class="card-title">Special title treatment</h5>
									<p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
									<a href="#" class="btn btn-primary">Go somewhere</a>
									</div>
								</div>
							</div>
							<div class="col-6">
								<div class="card shadow">
									<h5 class="card-header">Featured</h5>
									<div class="card-body">
									<h5 class="card-title">Special title treatment</h5>
									<p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
									<a href="#" class="btn btn-primary">Go somewhere</a>
									</div>
								</div>
							</div>
			<div class="my-3 p-3 bg-body rounded shadow-sm">
			<h6 class="border-bottom pb-2 mb-0">Recent updates</h6>
			<div class="d-flex text-muted pt-3">
				<svg class="bd-placeholder-img flex-shrink-0 me-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder: 32x32" preserveAspectRatio="xMidYMid slice" focusable="false"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"/><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>

				<p class="pb-3 mb-0 small lh-sm border-bottom">
				<strong class="d-block text-gray-dark">@username</strong>
				Some representative placeholder content, with some information about this user. Imagine this being some sort of status update, perhaps?
				</p>
			</div>
			<div class="d-flex text-muted pt-3">
				<svg class="bd-placeholder-img flex-shrink-0 me-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder: 32x32" preserveAspectRatio="xMidYMid slice" focusable="false"><title>Placeholder</title><rect width="100%" height="100%" fill="#e83e8c"/><text x="50%" y="50%" fill="#e83e8c" dy=".3em">32x32</text></svg>

				<p class="pb-3 mb-0 small lh-sm border-bottom">
				<strong class="d-block text-gray-dark">@username</strong>
				Some more representative placeholder content, related to this other user. Another status update, perhaps.
				</p>
			</div>
			<div class="d-flex text-muted pt-3">
				<svg class="bd-placeholder-img flex-shrink-0 me-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder: 32x32" preserveAspectRatio="xMidYMid slice" focusable="false"><title>Placeholder</title><rect width="100%" height="100%" fill="#6f42c1"/><text x="50%" y="50%" fill="#6f42c1" dy=".3em">32x32</text></svg>

				<p class="pb-3 mb-0 small lh-sm border-bottom">
				<strong class="d-block text-gray-dark">@username</strong>
				This user also gets some representative placeholder content. Maybe they did something interesting, and you really want to highlight this in the recent updates.
				</p>
			</div>
			<small class="d-block text-end mt-3">
				<a href="#">All updates</a>
			</small>
			</div>

			<div class="my-3 p-3 bg-body rounded shadow-sm">
			<h6 class="border-bottom pb-2 mb-0">Suggestions</h6>
			<div class="d-flex text-muted pt-3">
				<svg class="bd-placeholder-img flex-shrink-0 me-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder: 32x32" preserveAspectRatio="xMidYMid slice" focusable="false"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"/><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>

				<div class="pb-3 mb-0 small lh-sm border-bottom w-100">
				<div class="d-flex justify-content-between">
					<strong class="text-gray-dark">Full Name</strong>
					<a href="#">Follow</a>
				</div>
				<span class="d-block">@username</span>
				</div>
			</div>
			<div class="d-flex text-muted pt-3">
				<svg class="bd-placeholder-img flex-shrink-0 me-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder: 32x32" preserveAspectRatio="xMidYMid slice" focusable="false"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"/><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>

				<div class="pb-3 mb-0 small lh-sm border-bottom w-100">
				<div class="d-flex justify-content-between">
					<strong class="text-gray-dark">Full Name</strong>
					<a href="#">Follow</a>
				</div>
				<span class="d-block">@username</span>
				</div>
			</div>
			<div class="d-flex text-muted pt-3">
				<svg class="bd-placeholder-img flex-shrink-0 me-2 rounded" width="32" height="32" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Placeholder: 32x32" preserveAspectRatio="xMidYMid slice" focusable="false"><title>Placeholder</title><rect width="100%" height="100%" fill="#007bff"/><text x="50%" y="50%" fill="#007bff" dy=".3em">32x32</text></svg>

				<div class="pb-3 mb-0 small lh-sm border-bottom w-100">
				<div class="d-flex justify-content-between">
					<strong class="text-gray-dark">Full Name</strong>
					<a href="#">Follow</a>
				</div>
				<span class="d-block">@username</span>
				</div>
			</div>
			<small class="d-block text-end mt-3">
				<a href="#">All suggestions</a>
			</small>
			</div>
			-->













		</main>
		<footer class="footer mt-auto py-2 bg-dark">
			<div class="container">
				<p class="mb-1 text-light">Low latency video mesh &copy; MayFly AI 2022</p>
			</div>
		</footer>

		<!-- Modal -->
		<div class="modal fade" id="modal-removeservice" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="staticBackdropLabel">Remove service</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<p id="modal-removeservice-bodytext">DEFAULT BODY TEXT</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
						<button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="removeservicebut">Ok</button>
					</div>
				</div>
			</div>
		</div>

		<script src="../components/jquery/dist/jquery.min.js"></script>
		<script src="../components/bootstrap-5.2.2-dist/js/bootstrap.bundle.min.js"></script>
		<script src="../components/chart-3.9.1/dist/chart.min.js"></script>
		<script src="../components/date-fns/1.9.0/date_fns.min.js"></script>
		<script src="../components/chartjs-adapter-date-fns/2.0.1/chartjs-adapter-date-fns.min.js"></script>
		<script src="../shared.js"></script>
		<script src="../editservices.js"></script>
		<script src="../picam.js"></script>

		<script>
			function ClickBreadCrumbs(name) {
				console.log("ClickBreadCrumbs:"+name);
			}

			function SetBreadCrumbs(crumbs) {
				let bc=document.getElementById("breadcrumbList");
				bc.innerHTML="";
				let newOL=document.createElement("ol");
				newOL.classList.add("breadcrumb");
				newOL.classList.add("m-2");
				for(let i=0;i!=crumbs.length;i++) {
					let newLI=document.createElement("li");
					newLI.classList.add("breadcrumb-item");
					if(i==crumbs.length-1) {
						//newLI.classList.add("active");
						//newLI.setAttribute("aria-current", "page");
						newLI.innerHTML="<a>"+crumbs[i]+"</a>";
					}else{
						newLI.m_callback=onclick;
						newLI.m_crumbName=crumbs[i];
						newLI.innerHTML="<a href='' onclick='return false;'>"+crumbs[i]+"</a>";
						//newLI.innerHTML="<button class='btn btn-link btn-sm'>"+crumbs[i]+"</button>";
						addEventHandler(newLI,"click",function(e) {
							//console.log("her:"+this.m_crumbName);
							ClickBreadCrumbs(this.m_crumbName);
						});
					}
					newOL.appendChild(newLI);
				}
				bc.appendChild(newOL);
			}
			window.addEventListener('DOMContentLoaded', (event) => {
				SetBreadCrumbs(["Home","Dashboard"]);
			});
			document.querySelector('#navbarSideCollapse').addEventListener('click', function () {
				document.querySelector('.offcanvas-collapse').classList.toggle('open')
			})
			$(".nav-link").on("click",function(){
			    document.querySelector('.offcanvas-collapse').classList.toggle('open')
				$("nav").find(".nav-link").removeClass("active");
				$(this).addClass("active");
			});

			let connectionReady=false;
			var g_connection=new WebSocket('ws://'+window.location.host);
			g_connection.binaryType='arraybuffer';
			g_connection.onopen=function () {
				console.log('WebSocket open');
				connectionReady=true;
				ShowView('dashboard');
			};
			g_connection.onerror=function (error) {
				console.log('WebSocket error:' + error);
				connectionReady=false;
			};
			g_connection.onclose=function () {
				console.log('WebSocket close');
			};
			g_connection.onmessage=function (e) {
				var jsonMsg=new Uint8Array(e.data);
				var jsonString=bin2String(jsonMsg,0,jsonMsg.byteLength);
				var message=JSON.parse(jsonString);
				if(typeof(message.queryId)!='undefined') {
					var key='i_'+message.queryId;
					if(message.content!='undefined') {
						if(typeof(g_socketQueue[key].rf)=='function') {
							g_socketQueue[key].rf(message.content);
						}
					}else{
						console.log("query malformed:"+jsonString);
					}
				}else
				if(typeof(message.status)!=="undefined") {
					//console.log("local status:"+jsonMsg.byteLength);
					SetStatus(message);
				}else
				if(typeof(message.connections)!=="undefined") {
					MessageProperties(message);
				}else
				if(typeof(message.clients)!=="undefined") {
					MessageDashboard(message);
				}else{
					var str=JSON.stringify(message, null, 2); // spacing level = 2
					console.log("unhandled json:"+str);
				}
			};

			function EncodeAndSend(json) {
				json.type="query";
				let jsonString=JSON.stringify(json);
				try {
					g_connection.send(jsonString);
				} catch (e) {
					console.log('sendCommand failed');
				}
			}
			var g_socketQueueId=10000;
			var g_socketQueue={};
			function SendRequest(type,content,onReturnFunction) {
				g_socketQueueId++;
				let query={version:"1.0@DG",queryType:type,queryContent:content,queryId:g_socketQueueId};
				let key='i_'+g_socketQueueId;
				if(typeof(onReturnFunction)=='function') {
					g_socketQueue[key]={rf:onReturnFunction,m_done:false,m_queryType:query.queryType};
				}
				EncodeAndSend(query);
			}


			var prevViewName;
			function ShowView(viewName) {
				console.log("ShowView "+viewName);
				//let status=document.getElementById("showstatusdiv");
				//let props=document.getElementById("showpropsdiv");
				let dashboard=document.getElementById("showdashboarddiv");
				let services=document.getElementById("editservicesdiv");

				//status.style.display="none";
				//props.style.display="none";
				dashboard.style.display="none";
				services.style.display="none";
				switch(prevViewName) {
					case "dashboard": {
						EndDashboard();
						break;
					};
					case "services": {
						EndEditServices();
						break;
					};
				}
				switch(viewName) {
					case "dashboard": {
						BeginDashboard();
						dashboard.style.display="block";
						break;
					};
					case "services": {
						BeginEditServices();
						services.style.display="block";
						break;
					};
				}
				prevViewName=viewName;
			}
			g_pushMessagesNotify=[];
			function AddPushMessageCallback(key,func) {
				g_pushMessagesNotify[key]=func;
			}
			function RemovePushMessageCallback(key) {
				delete g_pushMessagesNotify[key];
			}
			function CallPushMessageCallbacks(json) {
				for(const [key,func] of Object.entries(g_pushMessagesNotify)) {
					func(json);
				}
			}
		</script>
	</body>
</html>
